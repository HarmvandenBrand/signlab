<!doctype html>
<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Breaking the sign language barrier</title>

<meta http-equiv="Access-Control-Allow-Origin" content="*">
<meta http-equiv="Access-Control-Allow-Methods" content="GET">
<meta http-equiv="Access-Control-Allow-Methods" content="POST">

<!-- Meta tag to make the website responsive to different types of devices -->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<!-- CSS files -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="static/cwasa.css">

<!-- Needed for bootstrap functionality: jQuery, Popper.js, Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>


<script 
  type="text/javascript" 
  src="cwa/allcsa.js">  
</script>

<!-- imports stylesheet for autocomplete -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css"></link>
<!-- imports stylesheet for tooltip -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<!-- imports necessary jquery-->
<script type="text/javascript" src="../static/jquery-3.5.1.min.js"></script>
<!-- imports jquery UI necessary for autocomplete and tooltip -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<!-- imports stylesheet for question circle -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

<script language="javascript">

function playURL(surl) {
	CWASA.playSiGMLURL(surl);
}

function playText(stext) {
	CWASA.playSiGMLText(stext);
}

// verandert de source van de embedded video
function changeVideo(url) {
  window.frames['videos'].location.replace(url);
  // document.getElementById('videos').src = "https://www.youtube-nocookie.com/embed/f7xMGTE7D5w";
  document.getElementById('test').innerHTML = document.getElementById('videos').src;
}

function addStatus(evt) {
	var elt = document.getElementById("myStatusLog");
	var msg = evt.msg;
	if (evt.av != "*") {
		msg = "[av" + evt.av + "] " + msg;
	}
	elt.value = elt.value + msg + "\n";
}
CWASA.addHook("status", addStatus);

var lggr = CWASA.getLogger("CWASA", "trace");

function setFPS(evt) {
	var elt = document.getElementById("myFPS");
	elt.value = evt.msg.toFixed(2);
}
CWASA.addHook("avatarfps", setFPS, 0);

function setSignFrame(evt) {
	var msg = evt.msg;
	var elt = document.getElementById("mySF");
	elt.value = (msg.s+1)+"/"+(msg.f+1);
	elt = document.getElementById("myGloss");
	elt.value = msg.g;
}
CWASA.addHook("avatarsign", setSignFrame, 0);

</script>


<script>
// let scrapeJSON = 'http://bluegalaxy.info/cgi/scrapeJSON.py'

// Defines the functions and variable necessary for autcomplete suggestions
$( function() {

  // Defines all the options for autocomplete suggestions
  var options = ["Goedemorgen","Goedemiddag","Goedenavond","Tot ziens","Tot morgen","Heeft U goed geslapen?","Welterusten","Eet smakelijk","Ik kom op een later moment terug.","Ik moet even weg.","Sorry, ik heb geen tijd.","Ik ga u een nieuw infuus geven.","De arts gaat u een nieuw infuus geven.","De verpleegkundige gaat u een nieuw infuus geven.","Een laborant komt bloedprikken (Voor Avatar: een laborant komt in de ochtend/ middag bloedprikken).","Een co- assistent (student in opleiding tot arts) komt bloedprikken.","Een collega komt bloedprikken.","Sorry, het lukt mij niet het infuus te prikken. Ik ga een collega vragen.","De MRI is goed.","De bloeduitslagen zijn goed.","De bloeduitslagen zijn niet helemaal goed.","De uitslag van de CT scan is goed.","De uitslag van de CT scan is niet helemaal goed.","De röntgenfoto is verbeterd.","De röntgenfoto is verslechterd.","De röntgenfoto is hetzelfde gebleven.","Heeft u pijn?","Op een schaal van 0-10, waarbij 0 ‘geen pijn’ is en 10 de meeste pijn die u zich kunt voor stellen, hoeveel pijn heeft u?","Waar heeft U pijn?","Wat voor soort pijn heeft U? Drukkend, stekend, krampend of anders omschrijven?","Ik kom het infuus controleren (of het nog goed loopt).","U moet in bed blijven.","Als U op de Intensive care ligt bellen de artsen of verpleegkundigen elke dag met uw contactpersoon om te vertellen hoe het gaat.","Ik ga nu het zuurstof kapje over uw neus en mond doen.","Er gebeuren vandaag geen onderzoeken of gesprekken meer.","De COVID-19 test is negatief, dit betekent dat u waarschijnlijk geen Corona heeft.","Soms heeft de test het fout dus we gaan nog meer onderzoek doen.","De COVID-19 test is positief, dit betekent dat u wel Corona heeft.","We gaan in het bloed testen of U antistoffen tegen Corona heeft. Als U antistoffen heeft betekent dit dat U nu Corona heeft of dat U Corona heeft gehad in het verleden.","De Coronatest in het bloed is negatief: u heeft geen antistoffen tegen Corona.","De Coronatest in het bloed is positief: u heeft wel antistoffen tegen Corona.","Met dit recept kunt U medicijnen ophalen bij apotheek.","Met dit recept kan iemand anders medicijnen voor U ophalen bij de apotheek.","Bent U ergens allergisch voor?","Waar bent u allergisch voor?","Gebruikt u medicijnen?","Welke medicijnen gebruikt u?","Kan iemand (thuis) een foto maken van de medicijnen die u gebruikt?"," Rookt u?","Bent U weleens eerder (voor u zelf) in het ziekenhuis geweest?","Welk ziekenhuis was U toen en waarom?","Wanneer was dat?","Zijn er mensen in Uw omgeving ziek?","Welke apotheek komt u?","Wie is uw huisarts?","Wat is uw geboortedatum?","Heeft u speciale dieetwensen? Zoals vegetarisch, veganistisch of bepaalde producten niet?","Heeft U gehoorapparaten of een CI?","Hoe wilt U het liefst communiceren als er geen tolk is? Met liplezen? Zinnen opschrijven? Via deze computer? Of iets anders?","Wilt u toegang tot uw elektronisch dossier? Daarmee kunt u thuis via de computer uitslagen van onderzoeken in zien.","Ik moet naar de wc.","Moet u naar de wc?","Kan ik U helpen?","Ik ga u wassen.","Ik ga u helpen met douchen.","U moet in de douche op de stoel zitten","Wilt u videobellen?","Zal ik u helpen zodat u kunt videobellen?","Dit is de alarmknop, als u hierop drukt dan komt er iemand naar u toe.","Wilt u een tv met teletekst zodat u de ondertiteling kunt aanzetten?","Wat wilt u eten?","Wat wilt u eten, kunt u het aanwijzen op de kaart?","Wat wilt u drinken?","Wat wilt u drinken, kunt u het aanwijzen op de kaart?","Heeft u het warm?","Heeft u het koud?","Het bed gaat nu omhoog.","Het bed gaat nu omlaag.","Wie komt U ophalen?","Ik help U.","Wij helpen U.","Heeft U in de afgelopen 24 uur een van deze klachten gehad: Hoesten, verkoudsheidsklachten, verhoging of koorts, benauwdheid, reuk en/ of smaak verlies?","Heeft U op dit moment een huisgenoot met koorts en/ of benauwdheidsklachten?","Heeft U de afgelopen 7 dagen een Corontest gehad? Zo ja, was deze positief?","Heeft U een huisgenoot/ gezinslid met klachten van het Coronavirus?","Bent U in quarantaine omdat U direct contact heeft gehad met iemand waarbij het nieuwe Coronavirus is vastgesteld? Of heeft U de afgelopen 14 dagen contact gehad met iemand die het Coronavirus heeft?"];

  // Defines the filter that searches the list of options for matches
  function customFilter(array, terms) {
    arrayOfTerms = terms.split(" ");
    punctuation = ["?",",",".",";",":","/"];
    arrayOfTerms.forEach(function (term) {
      if (punctuation.includes(term)) {
        var matcher = new RegExp("\\" + term, "i");
      }
      else{
        var matcher = new RegExp("\\b" + term, "i");
      }
      array = $.grep(array, function (value) {
       return matcher.test(value.label || value.value || value);
      });
    });
    return array;
  }

  // Activates the jquery autocomplete function when the user gives input
  $( "#mySiGML" ).autocomplete({
    source: options,
    appendTo: "#autocomp",
    multiple: true,
    mustMatch: false,
    source: function (request, response) {
        response(customFilter(options, request.term));
    },
  });
});

// Stores the json dictionary of translated sentences as a variable
var json = (function() {
  var json = null;
  $.ajax({
    'async': false,
    'global': false,
    'url': "sentencesDict.json",
    'dataType': "json",
    'success': function(data) {
      json = data;
    }
  });
  return json;
})();

var jsonvideo = (function() {
  var jsonvideo = null;
  $.ajax({
    'async': false,
    'global': false,
    'url': "videoDict.json",
    'dataType': "json",
    'success': function(data) {
      jsonvideo = data;
    }
  });
  return jsonvideo;
})();

// Checks the dictionary for an entry that matches 'text' and sends the SiGML code to the avatar
function toSiGML(text){
  // if avatar is checked, sigml is sent
  if (document.getElementById("avatarDisplay").checked) {
    entry = json[text];
    if (entry == undefined) {
      alert("There is currently no translation available. Please send the sentence you were trying to translate to us via the suggestions box on this page and/or try out our freestyle option.")
    }
    else{
      playText(entry);
    }
  }
  // if video is checked, source of embedded video changes
  else if (document.getElementById("videoDisplay").checked) {
    entry = json[text];
    if (entry == undefined) {
      alert("There is currently no translation available. Please send the sentence you were trying to translate to us via the suggestions box on this page and/or try out our freestyle option.")
    }
    else{
    changeVideo(entry);
    }
  }
}




function changeFunc(myRadio) {
  if (myRadio.value == "avatar") {
    document.getElementById("avatar").setAttribute("class", "CWASAAvatar av0");
    document.getElementById("videos").setAttribute("class", "undisplayed");
    document.getElementById("play").setAttribute("class", "displayed");
    document.getElementById("freestyle").setAttribute("class", "undisplayed");
  }
  else if (myRadio.value == "freestyle") {
    document.getElementById("avatar").setAttribute("class", "CWASAAvatar av0");
    document.getElementById("videos").setAttribute("class", "undisplayed");
    document.getElementById("play").setAttribute("class", "undisplayed");
    document.getElementById("freestyle").setAttribute("class", "displayed");
  }
  else if (myRadio.value == "video") {
    document.getElementById("avatar").setAttribute("class", "undisplayed");
    document.getElementById("videos").setAttribute("class", "prerecorded");
    document.getElementById("play").setAttribute("class", "displayed");
    document.getElementById("freestyle").setAttribute("class", "undisplayed");
  }
}

function openPage(event,page){
  // Declare all variables
  var i, tabcontent, tablinks;

  // Get all elements with class="tabcontent" and hide them
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Get all elements with class="tablinks" and remove the class "active"
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  // Show the current tab, and add an "active" class to the button that opened the tab
  document.getElementById(page).style.display = "block";
  event.currentTarget.className += " active";
}

function goPython(text){
    $.ajax({
      method: "GET",
      url: "/test.php",
      data: {"text": text},
      // contentType: "application/json;charset=UTF-8",
      // beforeSend: function() {
      //   alert(text);
      // },
      success: function(result) {
        // console.log (result);
        alert(result);
        // alert(response);
      },
      error: function() {
        alert('Something went wrong');
        },
     });
}

function displayInfo(id){
  document.getElementById(id).setAttribute("class", "displayInfo");
}

function undisplayInfo(id){
  document.getElementById(id).setAttribute("class", "undisplayed");
}

// Displays titles of all HTML elements as a tooltip
$( function() {
    $(document).tooltip({
      position: { my: "left+15 center", at: "right center"},
    });
});

function addSuggestion(suggestion){
  // Requiring fs module in which 
  // writeFile function is defined. 
  const fs = require('fs');
    
  // Write data in 'Output.txt' . 
  fs.appendFile('suggestions.txt', suggestion, (err) => { 
        
      // In case of a error throw err. 
      if (err) throw err; 
  });
}

</script>

<!-- <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/brython@3.8.9/brython.min.js">
</script>

<script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/brython@3.8.9/brython_stdlib.js">
</script> -->

<!-- Necessary for translating python into javascript -->
<!-- <script src="static/brython.js"></script>
<script src="static/brython_stdlib.js"></script> -->


</head>

<!-- <body onload="CWASA.init(); brython(1);"> -->
<!-- <body onload="brython(1);"> -->
<body onload="CWASA.init();">


<!--================================================================-->

<!-- Navigation bar -->

<nav class="navbar navbar-expand navbar-dark bg-info"> 
  <a class="navbar-brand mx-auto order-md-last" href="#">SignTranslation</a>
  
  <div class="collapse navbar-collapse" id="navbarColor03">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#" onclick="openPage(event, 'Home')">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="openPage(event, 'Translate')">Translate!</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="openPage(event, 'Team')">Team</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="openPage(event, 'Partners')">Partners</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="openPage(event, 'Funding')">Funding</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Further resources</a>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="#" onclick="openPage(event, 'devTools')">Developer tools</a>
          <a class="dropdown-item" href="#" onclick="openPage(event, 'Literature')">Literature</a>
          <a class="dropdown-item" href="#">Add something else?</a>
        </div>
      </li>
    </ul>
  </div>
</nav>



<!-- <div class="tab" align="center">
  <button id="defaultOpen" class="tablinks" onclick="openPage(event, 'Translate')">Translate to NGT</button>
  <button class="tablinks" onclick="openPage(event, 'Software')">Software</button>
</div>
 -->

<!-- Home -->
<div id="Home" class="tabcontent" align="left" width="100%">

  <p>
    In times of COVID-19, communication between health care providers and deaf patients is very difficult, because sign language interpreters are often not allowed to enter the hospital and mouth caps make lipreading impossible.
  </p>

  <p>
    We are developing an online tool that translates the most common questions and announcements in the diagnosis and treatment of COVID-19 from Dutch into Dutch Sign Language. Translations are displayed by means of videos and animated avatars.
  </p>


<!--   <div>
    Welcome to our website! We are developing tools to automatically translate text into sign language. 
    While such tools are in a very early stage of development,
    they can already be useful for certain purposes.
  </div>
  <div>
    Currently, we are developing a tool to help hospital personnel communicate with deaf patients. In times of COVID-19, sign language interpreters
    are often not allowed to enter the hospital and mouth caps make lipreading impossible. This makes communication with deaf patients even more difficult
    than it usually is. We hope that our tool will help to address this problem.
  </div> -->
</div>

<!-- Translate -->

<div id="Translate" class="tabcontent" align="center" width="100%">
  <!-- CWA signing avatar panel 0 -->
  <!--================================================================-->
  <!-- <div class="CWASAPanel av0" align="center" ></div> -->
  <span id="avatar" class="CWASAAvatar av0" align="left" ></span>
  <!--================================================================-->

  <span id="videos" class="undisplayed" align="left">
    <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/kfrivlDWyJw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe>
  </span>

  <span align="left" style="display:inline-block; vertical-align:top; margin:30px;">
  <label for="option" style="margin-right:-100px; margin-bottom:-5px">Choose a display option:</label>

  <br>
   <!-- Defines the button and questioncircle displayed for the option "avatar" -->
    <input type="radio" id="avatarDisplay" name="display" value="avatar" checked onclick="changeFunc(this);">
    <label for="avatar" style="margin-right: 5px">Avatar</label>
    <i class="fa fa-question-circle" title="Displays the translation of select sentences using an avatar"></i>
 
  
  <br>
  <!-- Defines the button and questioncircle displayed for the option "video" -->
    <input type="radio" id="videoDisplay" name="display" value="video" onclick="changeFunc(this);">
    <label for="video" style="margin-right:5px">Video</label>
    <i class="fa fa-question-circle" title="Displays the translation using a video"></i>
  
  <br>
  <!-- Defines the button and questioncircle displayed for the option "freestyle" -->
  <input type="radio" id="freestyleDisplay" name="display" value="freestyle" onclick="changeFunc(this);">
  <label for="freestyle" style="margin-right:5px">Freestyle with Avatar</label>
  <i class="fa fa-question-circle" title="Attempts to translate any Dutch sentence into NGT using an avatar (experimental)"></i>

    <br>
    <br>
    Enter Sentence:
    <br>
    <span class="ui-widget" id="autocomp">
      <input id="mySiGML" class="txtaSiGMLText" style="margin-top:10px; margin-bottom:10px;">
    </span>

    <br>
    <input type="button" id="play" value="Translate" onclick='toSiGML(document.getElementById("mySiGML").value);'/>
    <input type="button" id="freestyle" value="Freestyle" class="undisplayed">
   <!--  <input type="button" id="play" value="Translate" onclick='playURL("house.sigml");'/> -->
    <input type="button" value="Stop" onclick='CWASA.stopSiGML();' />

    <!-- <script type="text/python" src="test.py"></script> -->
    <!-- <button id="freestyle" onclick='goPython(document.getElementById("mySiGML").value);'>freestyle</button> -->
    <br>
    <br>
    Adjust speed: <span class="CWASASpeed av0"></span>
    <br>

    <label for="suggestions">Suggestions box: </label>
    <input id="suggestions" class="txtaSiGMLText" style="margin-top:10px; margin-bottom:10px; width: 250px;">
   <!--  <input type="button" value="Send" onclick='addSuggestion(document.getElementById("suggestions").value);' style="display: inline-block;" /> -->
  </span>

  <!-- <button id="echo" onclick='suggestions(document.getElementById("mySiGML").value);'>click !</button> -->

  <!-- FR: I've made the following progress fields invisible, if you comment them out completely the avatar doesn't work anymore -->
  <div align="center" class="undisplayed">

    <span style="font-size: 90%;" >
      Sign/Frame:
      <input id="mySF" class="txtSF" value="0/0" type="text" />
      &nbsp;
      Gloss:
      <input id="myGloss" class="txtGloss" value="[none]" type="text" />
      &nbsp;
      FPS:
      <input id="myFPS" class="txtFPS" value="00.00" type="text" />
    </span>
  </div>


  <div align="center">
      <!-- FR: I've made the following status log field invisible, if you comment it out completely the avatar doesn't work anymore -->
      <textarea id="myStatusLog"  class="statusLog undisplayed" rows="6">
      </textarea>
  </div>

  <br>


  <!-- SToCA applet element panel -->
  <!--================================================================-->
  <div class="SToCA" align="center" ></div>
  <!--================================================================-->
</div>

<!-- Team page -->
<div id="Team" class="tabcontent" align="left" width="100%">

  
  <p>
    <b>Coordination</b><br>
    Floris Roelofsen, University of Amsterdam<br>
    Anika Smeijers, Amsterdam Medical Centre<br>
  </p>

  
  <p>
    <b>Avatar and interface development</b><br>
    Lyke Esselink, University of Amsterdam<br>
    Shani Mende-Gillings, University of Amsterdam<br> 
   </p>
   <p>
    <b>Video translations</b><br>
    <a href="https://www.wattelt.org/" target="_blank">Wat Telt!</a><br>
    <a href="https://maxvonk.com/">Max Vonk video productions</a><br>
   </p>
  
</div>

<!-- Funding page -->
<div id="Funding" class="tabcontent" align="left" width="100%">
 <p>
  We gratefully acknowledge funding from the Netherlands Organisation for Innovation in Healthcare (ZonMw) through the
  <a href="https://www.zonmw.nl/nl/over-zonmw/coronavirus/programmas/programma-detail/covid-19-programma/" target="_blank">COVID-19 programme</a>.  
 </p> 
 <p>
   <!-- <img src="images/ZonMWlogo.png" alt="ZonMW logo" width="150" height="60" style="display: inline-block;"> -->
 </p>
</div>

<!-- Partners page -->
<div id="Partners" class="tabcontent" align="left" width="100%">
 <p>
  Our translation tool makes use of the 
  <a>JASinging avatar software</a>
  developed by the
  <a>Virtual Humans Group </a>
  at the
  <a>University of East Anglia</a>.
 </p> 
 <p>
   We are very grateful to John Glauert for providing a distribution of the software for our project.
 </p>
</div>

<!-- "Software" page -->
<div id="Software" class="tabcontent" align="center">
  <p>The avatar software used for displaying the translations has been provided by John Glauert.</p>
  <p>This project was funded by </p>
</div>

<!-- Clicks on the page set as default to make sure it is diplayed when the website is loaded -->
<script>document.getElementById("defaultOpen").click();</script>
</body>
</html>
